define(["exports","module"],function(n,t){"use strict";function r(n){if(Array.isArray(n)){for(var t=0,r=Array(n.length);t<n.length;t++)r[t]=n[t];return r}return Array.from(n)}function e(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function n(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}}(),u=function(){function n(){e(this,n),this._subscriptions=new WeakMap,this._informants=new WeakMap}return i(n,[{key:"_push",value:function(n,t,e){var i=[e];n.has(t)&&(i=[].concat(r(i),r(n.get(t)))),n.set(t,i)}},{key:"_filter",value:function(n,t,r){if(n.has(t)){var e=n.get(t).filter(r);n.set(t,e)}}},{key:"subscribe",value:function(n,t,r){this._push(this._subscriptions,n,{event:t,fn:r})}},{key:"unsubscribe",value:function(n,t,r){var e=function(n){return n.event!==t||n.fn!==r};this._filter(this._subscriptions,n,e)}},{key:"publish",value:function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),i=2;r>i;i++)e[i-2]=arguments[i];var u=this;this._subscriptions.has(n)&&this._subscriptions.get(n).filter(function(n){return n.event===t}).map(function(n){return n.fn}).forEach(function(n){return n.apply(void 0,e)}),this._informants.has(n)&&this._informants.get(n).forEach(function(n){return u.publish.apply(u,[n,t].concat(e))})}},{key:"publishAsync",value:function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),i=2;r>i;i++)e[i-2]=arguments[i];var u=this;setTimeout(function(){return u.publish.apply(u,[n,t].concat(e))},0)}},{key:"inform",value:function(n,t){this._push(this._informants,n,t)}},{key:"conceal",value:function(n,t){var r=function(n){return t!==n};this._filter(this._informants,n,r)}}]),n}();t.exports=new u});
