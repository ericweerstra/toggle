define(["exports","module","utils/DOMHelpers","utils/Observer","toggle/Toggle"],function(e,t,i,n,s){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=l(n),r=l(s),_="height",g="transitionend",u="collapsible-transition",c=function(){function e(t,i){o(this,e),this._element=t,this._options=i||{},this._collapsingElement=this._createCollapsingElement(),this._toggle=new r["default"](t,this._options),this._initialize()}return a(e,[{key:"_initialize",value:function(){this._expand=this._expand.bind(this),this._collapse=this._collapse.bind(this),this._onTransitionEnd=this._onTransitionEnd.bind(this),h["default"].subscribe(this._toggle,this._toggle.activeEvent,this._expand),h["default"].subscribe(this._toggle,this._toggle.inActiveEvent,this._collapse),this._collapsingElement.addEventListener(g,this._onTransitionEnd),this._setHeight(0),this._toggle.active&&this._expand()}},{key:"_createCollapsingElement",value:function(){var e=document.createElement("div");return e.classList.add(u),this._element.parentNode.insertBefore(e,this._element),e.appendChild(this._element),e}},{key:"_getHeight",value:function(){return this._element.offsetHeight}},{key:"_setHeight",value:function(e){(0,i.setPrefixedStyle)(this._collapsingElement,"transition","none"),this._collapsingElement.style.height=e,(0,i.reflow)(this._collapsingElement),(0,i.setPrefixedStyle)(this._collapsingElement,"transition","")}},{key:"_expand",value:function(){this._collapsingElement.style.height=this._getHeight()+"px"}},{key:"_collapse",value:function(){this._setHeight(this._getHeight()+"px"),this._collapsingElement.style.height=0}},{key:"_onTransitionEnd",value:function(e){e.propertyName===_&&this._toggle.active&&this._setHeight("auto")}},{key:"unload",value:function(){this._element.removeAttribute("style"),h["default"].unsubscribe(this._toggle,this._toggle.activeEvent,this._expand),h["default"].unsubscribe(this._toggle,this._toggle.inActiveEvent,this._collapse),this._toggle.unload(),this._collapsingElement.parentNode.insertBefore(this._element,this._collapsingElement),this._collapsingElement.parentNode.removeChild(this._collapsingElement),this._element.removeEventListener(g,this._onTransitionEnd)}}]),e}();t.exports=c});
